<style>
  h1 {
    white-space: nowrap;
    margin: 0 30 10 30;
    font-size: 13pt;
  }
  #dis {
    margin-top: 16;
  }
  .in {
    margin: 0;
    padding: 0;
    text-align: center;
  }
  td,
  th,
  .u,
  .l {
    border: 1px solid black;
    width: 1em;
    height: 1em;
  }
  .s {
    border: none;
    text-align: center;
  }
  .sc {
    border: none;
    width: 1em;
  }
  .sb {
    border-right: 1px dashed black;
  }
  th {
    background: black;
  }
  .i {
    cursor: pointer;
    position: absolute;
    padding: 5 10;
  }
  .br {
    border-radius: 20px;
  }
  .tr {
    transition: all 1s, max-width 1s, max-height 1s, top 1s, right 1s;
  }
  .u,
  .l {
    margin: auto;
  }
  .u {
    background-color: black;
  }
</style>
<div id="f-ct" style="color: white; background-color: black; height: 100%; overflow: hidden; font-family: sans-serif">
  <div
    id="i"
    class="br tr"
    style="
      min-width: 220;
      min-height: 72;
      opacity: 1;
      max-width: 500;
      position: absolute;
      top: 0;
      left: 0;
      outline: 1px solid rgba(0, 0, 0, 0.5);
      box-shadow: 2px 2px 10px 1px rgba(0, 0, 0, 0.5);
      margin: 1em;
      padding: 0.5em 0.5em 2em 0.5em;
      opacity: 0.85;
    "
  >
    <div id="h" onMouseOver="mIn(this)" onMouseOut="mOu(this)" class="i br" style="right: 0; top: 0; margin: 2">
      ‚úñ
    </div>
    <h1 class="s">üå± Smart Life</h1>
    <div
      id="s"
      onMouseOver="mIn(this,0)"
      onMouseOut="mOu(this)"
      class="i br s"
      style="z-index: 2; left: 0; right: 0; bottom: 0; margin: 1px"
    >
      ‚ñº
    </div>
    <div id="k" class="tr" style="right: 0; top: 36; position: absolute; display: flex; flex-direction: column">
      <p class="in">ü°π&nbsp;</p>
      <p class="in">ü°∏ü°ªü°∫&nbsp;</p>
      <p class="in">üìúüîç</p>
    </div>
    Rule: <b id="rN"></b><br />Gens: <b id="Y"></b>
    <div class="tr" style="max-height: 0; max-width: 0; opacity: 0; margin: 30 2" id="hid">
      <div style="width: 8em; margin: -72 auto 0 auto; padding-bottom: 20; text-align: center">
        Spin: <input type="checkbox" checked id="sp" />
        <div id="l" style="display: none">Sparkles: <input type="checkbox" id="p" /></div>
      </div>
      <div id="dis" />
      <br />
    </div>
  </div>
</div>
<canvas width="256" height="256" style="display: none" id="c1"
  ><canvas width="256" height="256" style="display: none" id="c2"
    ><script>
    let mIn = (t, b = 1) => {
      if (b) t.style.outline = '1px solid black';
      t.style.backgroundColor = 'rgba(255,255,255,0.7)';
    },
    mOu = (t) => {
      t.style.outline = 'none';
      t.style.backgroundColor = '';
    };
    window.mOu=mOu;
    window.mIn=mIn;
      let f = () => {
        let u = document,
          E = 'getElementById',
          EL = 'addEventListener',
          ct = u.querySelector('#f-ct'),
          nft = window?.cardano?.nft;
        if (!nft || typeof THREE == 'undefined') {
          ct.innerHTML = 'CIP54 missing - Try Plutus.art';
          return;
        }
        nft.getTokens().then((oT) => {
          nft.getMetadata().then((m) => {
            let iS = u[E]('i').style,
              vs =
                'varying vec3 vWP;void main(){vec4 wP=modelMatrix*vec4(position,1.0);vWP=wP.xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}',
              fs =
                'uniform vec3 tC;uniform vec3 bC;uniform float o;uniform float ex;varying vec3 vWP;void main(){float h=normalize(vWP+o).y;gl_FragColor=vec4(mix(bC,tC,max(pow(max(h,0.0),ex),0.0)),1.0);}',
              d = 1000,
              TL = oT.tokens,
              w = window,
              O,
              rN = m.rule,
              Y = 256,
              rot = 0,
              W = Y*2 + 1,
              Ts = null,
              l,
              j = 0,
              R,
              T = THREE,
              Co = T.Color,
              WT = 0xffffff,
              cW = ct.clientWidth,
              cH = ct.clientHeight,
              f = new T.Scene(),
              g = new T.BoxGeometry(1, 1, 2),
              gG = new T.PlaneGeometry(10000, 10000),
              N = new T.PerspectiveCamera(30, cW / cH, 25, W * 800),
              cP = N.position,
              al = new T.MeshStandardMaterial({ color: m.oC }),
              gM = new T.MeshPhongMaterial({ color: WT }),
              P = new T.WebGLRenderer({ antialias: 1 }),
              wH = new T.Vector2(cW / 2, cH / 2),
              hL = new T.HemisphereLight(WT, WT, 0.6),
              ly = loyal(),
              mO = 0;
            let dL = new T.DirectionalLight(WT, 1),
              dLS = dL.shadow,
              dLSM = dLS.mapSize,
              dLP = dL.position,
              sC = dLS.camera,
              gr = new T.Mesh(gG, gM),
              uf = {
                tC: { type: 'c', value: new Co(0x0077ff) },
                bC: { type: 'c', value: new Co(m.sC) },
                o: { type: 'f', value: 33 },
                ex: { type: 'f', value: 0.6 },
              },
              sG = new T.SphereGeometry(4000, 32, 15),
              sM = new T.ShaderMaterial({ vertexShader: vs, fragmentShader: fs, uniforms: uf, side: T.BackSide }),
              sky = new T.Mesh(sG, sM),
              G = 'createRadialGradient',
              A,
              pg,
              mats = [],
              pS,
              i,
              sp1,
              sp2,
              map,
              size,
              c1 = u[E]('c1'),
              c2 = u[E]('c2'),
              dC1 = c1.getContext('2d'),
              dC2 = c2.getContext('2d'),
              g2 = dC2[G](128, 128, m.fR, 128, 128, m.fO),
              g1 = dC2[G](128, 128, m.sR, 128, 128, m.sO),
              C = 'addColorStop',
              tr = 'rgba(0,0,0,0)',
              CT = T.CanvasTexture,
              pO = [],
              mX = (mY = 0),
              q = 0,
              pR,
              y,
              row,
              x,
              p1,
              p2,
              p3;
            iS.backgroundColor = m.dC;
            iS.color = m.fC;
            gr.rotation.x = -Math.PI / 2;
            gr.position.y = -33;
            hL.color = new Co(m.lC);
            f.background = new Co('black');
            hL.groundColor = new Co(WT);
            f.fog = new T.Fog(WT, 1, 5000);
            f.fog.color = new Co(m.hC);
            dL.color = new Co(m.gC);
            gM.color = new Co(m.pC);
            dL.castShadow = 1;
            dLSM.height = dLSM.width = 2048;
            dLS.radius = 10;
            dLS.blurSamples = 50;
            sC.bottom = sC.left = -(sC.top = sC.right = d);
            sC.far = 3500;
            sC.near = 0.5;
            gr.receiveShadow = 1;
            P.shadowMap.type = T.VSMShadowMap;
            (P.shadowMap.enabled = 1), (RN = (z) => Math.random(z));
            if (ly) {
              u[E]('l').style.display = 'block';
              u[E]('p').checked = 1;
            }
            hL.position.set(0, 500, 0);
            P.setSize(cW, cH);
            P.setPixelRatio(w.devicePixelRatio);
            ct.append(P.domElement);
            cP.set(0, 200, W * 2);
            f.add(hL);
            dLP.set(-2, 2.75, 5);
            dLP.multiplyScalar(50);
            f.add(dL);
            f.add(gr);
            uf.tC.value.copy(hL.color);
            f.add(sky);
            g2[C](0, m.aC);
            g2[C](1, tr);
            g1[C](0, m.bC);
            g1[C](1, tr);
            dC1.fillStyle = g1;
            dC1.fillRect(0, 0, 255, 255);
            dC2.fillStyle = g2;
            dC2.fillRect(0, 0, 255, 255);
            dC1.strokeStyle = m.cC;
            dC1.fillStyle = m.eC;
            dC1.lineWidth = 5;
            star(dC1, 128, 128, m.kP, m.kO, m.kR);
            sp1 = new CT(c1);
            sp2 = new CT(c2);
            for (i = 0; i < m.d; i++)
              pO.push(new T.Vector3(RN() * 2000 - 1000, RN() * 2000 - 1000, RN() * 2000 - 1000));
            pg = new T.BufferGeometry();
            pg.setFromPoints(pO);
            pS = [
              [sp1, m.k[0]],
              [sp2, m.k[1]],
              [sp1, m.k[2]],
              [sp2, m.k[3]],
              [sp1, m.k[4]],
            ];
            for (i = 0; i < pS.length; i++) {
              map = pS[i][0];
              size = pS[i][1];
              mats[i] = new T.PointsMaterial({ size, map, blending: T.AdditiveBlending, depthTest: 0, transparent: 1 });
              A = new T.Points(pg, mats[i]);
              pR = A.rotation;
              pR.x = RN() * 6;
              pR.y = RN() * 6;
              pR.z = RN() * 6;
              if (ly) f.add(A);
            }
            let fill = () => {
                O = [];
                for (y = 0; y < Y - 1; y++) {
                  (row = new Int8Array(W)), pR;
                  if (y == 0) pR = seed();
                  else pR = O[y];
                  for (x = 0; x < W; x++) {
                    (p1 = p3 = 0), (p2 = pR[x]);
                    if (x > 0) p1 = pR[x - 1];
                    if (x < W - 1) p3 = pR[x + 1];
                    row[x] = cell(p1, p2, p3);
                  }
                  if (y == 0) O.push(pR);
                  O.push(row);
                }
              },
              bitSet = (num, i) => num & (1 << i),
              cell = (p1, p2, p3) => {
                let p = 0;
                if (p1 == 1) p = p | (1 << 2);
                if (p2 == 1) p = p | (1 << 1);
                if (p3 == 1) p = p | (1 << 0);
                if (bitSet(rN, p)) return 1;
                return 0;
              },
              seed = () => {
                let r = new Int8Array(W);
                r[Math.round(W / 2) - 1] = 1;
                return r;
              };
            function loyal() {
              let p = [];
              for (let t of TL) {
                p.push(t.unit.substring(0, 56));
              }
              if (p.includes('781ab7667c5a53956faa09ca2614c4220350f361841a0424448f2f30')) return 1;
              return 0;
            }
            function star(ctx, cx, cy, sK, oR, iR) {
              let rT = (Math.PI / 2) * 3,
                x = cx,
                y = cy,
                sP = Math.PI / sK;
              ctx.beginPath();
              ctx.moveTo(cx, cy - oR);
              for (i = 0; i < sK; i++) {
                x = cx + Math.cos(rT) * oR;
                y = cy + Math.sin(rT) * oR;
                ctx.lineTo(x, y);
                rT += sP;
                x = cx + Math.cos(rT) * iR;
                y = cy + Math.sin(rT) * iR;
                ctx.lineTo(x, y);
                rT += sP;
              }
              ctx.lineTo(cx, cy - oR);
              ctx.closePath();
              ctx.stroke();
              ctx.fill();
            }
            function cS() {
              if (R) f.remove(R);
              R = new T.Group();
              R.position.set(0, Y / 2, 0);
              for (y = 0; y < Y; y++)
                for (x = 0; x < W; x++) {
                  if (O[y][x]) {
                    let C = new T.Mesh(g, al);
                    C.castShadow = 1;
                    C.position.set(x - W / 2, 0 - (y - Y / 2), 0);
                    R.add(C);
                  }
                }
              f.add(R);
            }
            function gen() {
              l = Ts;
              fill();
              cS();
            }
            function rotate(a) {
              if (!R) return;
              if (isNaN(a)) return;
              let r = R.rotation;
              rot -= (a / 33) * 0.02;
              r.y = rot;
            }
            function D() {
              u[E]('rN').innerHTML = rN;
              u[E]('Y').innerHTML = Y;
              let r = '<table><tr>',
                sR = '<tr>';
              for (let b = 0; b < 8; b++) {
                for (let i = 2; i >= 0; i--) r += !bitSet(b, i) ? '<th/>' : '<td/>';
                r += b != 7 ? '<td class="sc sb" /><td class=sc />' : '';
                sR +=
                  '<td class=s colspan=3>ü†ó<br><div class="' +
                  (bitSet(rN, 7 - b) ? 'u' : 'l') +
                  '" /></td>' +
                  (b != 7 ? '<td class="sc sb" /><td class=sc />' : '');
              }
              r += '</tr>' + sR + '</table>';
              u[E]('dis').innerHTML = r;
            }
            u.onkeyup = (e) => {
              e = e || w.event;
              switch (e.key.toUpperCase()) {
                case 'A':
                case 'ARROWLEFT':
                  rN--;
                break;
                case 'S':
                case 'ARROWDOWN':
                  Y -= 8;
                  q -= 25;
                break;
                case 'D':
                case 'ARROWRIGHT':
                  rN++;
                break;
                case 'W':
                case 'ARROWUP':
                  Y += 8;
                  q += 25;
                break;
              }
              W = Y * 2 + 1;
              if (Y < 32) Y = 32;
              if (rN < 0) rN = 255;
              if (rN > 255) rN = 0;
              D();
              gen();
            };
            u.resize = () => {
              N.aspect = cW / cH;
              N.updateProjectionMatrix();
              P.setSize(cW, cH);
            };
            u[E]('h')[EL]('click', () => {
              let s = u[E]('i').style;
              s.opacity = s.maxWidth = 0;
            });
            u[E]('s')[EL]('click', () => {
              let s = u[E]('hid').style;
              if (!mO) {
                u[E]('s').innerHTML = '‚ñ≤';
                s.opacity = 1;
                s.maxHeight = 100;
                s.maxWidth = 500;
                u[E]('k').style.top = 18;
                u[E]('k').style.right = 32;
              } else {
                u[E]('s').innerHTML = '‚ñº';
                s.opacity = 0;
                s.maxHeight = 0;
                s.maxWidth = 0;
                u[E]('k').style.top = 36;
                u[E]('k').style.right = 0;
              }
              mO = !mO;
            });
            u[E]('p')[EL]('change', (e) => {
              if (!A) return;
              let cL = f.children;
              for (i = 0; i < cL.length; i++) {
                let V = cL[i];
                if (V instanceof T.Points)
                  if (e.currentTarget.checked) V.visible = 1;
                  else V.visible = false;
              }
            });
            u[EL](
              'mousemove',
              (e) => {
                mX = e.clientX - wH.x;
                mY = e.clientY - wH.y;
              },
              0,
            );
            let tM = (e) => {
              if (e.touches.length == 1) {
                e.preventDefault();
                mX = e.touches[0].pageX - wH.x;
                mY = e.touches[0].pageY - wH.y;
              }
            };
            u[EL]('touchstart', tM, 0);
            u[EL]('touchmove', tM, 0);
            u[EL](
              'wheel',
              (e) => {
                q += e.deltaY;
                if (q > 400) q = 400;
                if (q < -400) q = -400;
              },
              0,
            );
            function RR(ts) {
              if (l == undefined) l = ts;
              let es = ts - Ts,
                cR = N.rotation;
              Ts = ts;
              if (es > 50 && Y > 20 && ts - l > 1000) {
                if (j) {
                  q -= Y * 1.5;
                  Y = Math.round(Y / 2);
                  W = Y * 2 + 1;
                  gen();
                  D();
                  j = 0;
                } else j = 1;
              } else j = 0;
              cP.x += (mX - cP.x) * 0.05;
              cP.y += (-mY - cP.y) * 0.05;
              if (cP.y < 50) cP.y = 50;
              if (q > 0) {
                cP.z += es;
                q -= es;
                if (q < 0) q = 0;
              } else if (q < 0) {
                cP.z -= es;
                q += es;
                if (q > 0) q = 0;
              }
              N.lookAt(new T.Vector3(0, Y / 2, 0));
              requestAnimationFrame(RR);
              if (u[E]('sp').checked) rotate(es);
              for (i = 0; i < f.children.length; i++) {
                let V = f.children[i];
                if (V instanceof T.Points) V.rotation.y = (ts / 20000) * (i < 4 ? i + 1 : -(i + 1));
              }
              P.render(f, N);
            }
            gen();
            D();
            RR();
            P.render(f, N);
          });
        });
      };
      f();
    </script></canvas
  ></canvas
>
