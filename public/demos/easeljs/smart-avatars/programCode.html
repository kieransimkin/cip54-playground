<style>
  h1 {
    white-space: nowrap;
    margin: 0 30 10 30;
    font-size: 13pt;
  }
  .s {
    text-align: center;
  }
  .cc {
    caret-color: #00000000;
    -webkit-user-select: none;
    user-select: none;
    overflow: hidden;
  }
  .pt,
  #z span,
  #z input {
    cursor: pointer;
  }
  .p {
    transition: all 1s, outline 0s;
  }
  .i {
    padding: 5 10;
  }
  .a,
  #z span,
  #z > p {
    position: absolute;
  }
  .br {
    border-radius: 20px;
  }
  #fT {
    position: absolute;
    opacity: 0;
  }
  .in {
    margin: 3 3;
    padding: 2 2;
    text-align: center;
  }
  #z > p > span {
    left: 22;
  }
  #z span:hover,
  #z input:hover {
    text-shadow: -1px 1px #ffc8fa66, 1px -1px #191900e6;
  }
  .y {
    left: -24;
  }
  .o {
    left: 85;
  }
  input {
    position: relative;
    left: 55;
  }
  #o {
    display: none;
  }
  #z > span {
    left: 166;
  }
  .np {
    pointer-events: none;
  }
  #z {
    text-transform: capitalize;
  }
  #z > p {
    display: inline;
    left: 62;
    margin: 0 0;
  }
  i {
    display: block;
    font-style: normal;
  }
</style>
<i
  class="np cc"
  style="
    height: 40vh;
    backdrop-filter: blur(20px) hue-rotate(580deg);
    position: fixed;
    z-index: 10;
    top: 60vh;
    left: 0;
    mask-image: linear-gradient(#00000000 0%, black 100%);
    -webkit-mask-image: linear-gradient(#00000000 0%, black 100%);
    width: 100vw;
  "
></i>
<i class="cc" style="display: flex; height: 100vh; background: black" id="l"
  ><canvas id="t"></canvas><input class="cc np" id="fT" />
  <i class="cc" id="f-ct" style="color: white; height: 100%; font-family: sans-serif">
    <i
      id="i"
      class="br p a"
      style="
        background: #5f9ea0cc;
        color: black;
        min-width: 520;
        opacity: 1;
        max-width: 500;
        left: 0;
        box-shadow: 2px 2px 10px 1px #00000080;
        margin: 1em;
        padding: 0.5em 0.5em 2em 0.5em;
      "
    >
      <i id="h" onclick="d[B]('i').style.opacity=0" class="i a br tr p pt" style="right: 0; margin: 2; top: 0"
        >‚úñ</i
      >
      <h1 class="s">Smart Avatars</h1>
      <i id="k" class="tr a" style="right: 0; top: 36; display: flex; flex-direction: column"
        ><i style="margin: auto auto"><p class="in p br pt" data-keyup="W">ü°π</p></i>
        <p class="in">
          <span class="in p br pt" data-keyup="A">ü°∏</span>
          <span class="in p br pt" data-keyup="S">ü°ª</span>
          <span class="in p br pt" data-keyup="D">ü°∫</span>
        </p>
        <p class="in">üìúüîç</p></i
      >
      <i id="z"> </i>
    </i>
  </i>
</i>
<i id="o" />
<script>
  let nft = window.cardano?.nft;

  let go = nft.getFileObject,
    children = [],
    H = 'height',
    Y = 'width',
    B = 'getElementById',
    gA = 'getAttribute',
    cE = 'createElement',
    d = document,
    sA = 'setAttribute',
    AC = 'append',
    PC = 'addChild',
    IP = parseInt,
    I = (ii) => {
      let CC = d[cE]('canvas');
      d[B]('o')[AC](CC);
      CC[sA]('id', ii);
    },
    tcan = d[B]('t'),
    eT = d[B]('l'),
    tS,
    JS = createjs,
    tw = JS.Tween.get;
  (V = 0),
    (zD = -1),
    (zU = -1),
    (gS = (s, i) => new JS.Sprite(s, i)),
    (gP = (p) => new JS.SpriteSheet(p)),
    tcan[sA](Y, eT.getBoundingClientRect()[Y]),
    tcan[sA](H, eT.getBoundingClientRect()[H]),
    (ret = { files: {}, tokens: [], images: [] }),
    (AEL = 'addEventListener'),
    (dS = 1),
    (SS = 1 + Math.pow(dS, 2)),
    (D = { step: 1 }),
    (zX = (IP(tcan[gA](Y)) - 64 * Math.pow(dS, 2)) / 2),
    (zY = (IP(tcan[gA](H)) - 64 * Math.pow(dS, 2)) / 2),
    (eA = 1),
    (wA = dA = nA = 0),
    (R = 'E'),
    (O = new JS.Container()),
    (oC = new JS.Container()),
    (tx = '#00000000'),
    (S = { S: {}, N: {}, W: {}, E: {} }),
    (e = (s, a) => {
      for (let c in s[a]) {
        O.removeChild(s[a][c]);
      }
      s[a] = {};
    }),
    (mIn = (t) => {
      t.style.outline = '1px solid black';
      t.style.backgroundColor = '#ffffffb3';
      t.style.boxShadow = '2px 1px #00000080';
    }),
    (mOu = (t) => {
      t.style.boxShadow = '';
      t.style.outline = 'none';
      t.style.backgroundColor = '';
    }),
    (SN = new SimplexNoise()),
    (BT = ['body', 'head', 'bangs', 'pants', 'shirt', 'jacket', 'trim', 'gloves', 'shoes']),
    (Su = 'substring'),
    (iH = 'innerHTML'),
    (U = 'drawRect'),
    (T = 'beginBitmapFill'),
    (q = 'checked'),
    (o = 'graphics'),
    (C = 1000),
    (zG = C/2);
  let P = (b) => {
    let CC = d[cE]('p');
    d[B]('z')[AC](CC, d.createTextNode(b + ': '), d[cE]('br'));
    CC[sA]('id', b);
  };
  for (let c of d.getElementsByClassName('pt')) {
    c[AEL]('mouseover', () => {
      mIn(c);
    });
    c[AEL]('mouseout', () => mOu(c));
  }
  for (const l of d.querySelectorAll('[data-keyup]')) { 
    
    l[AEL]('click',()=>{console.log('got here');console.log(l.attributes['data-keyup'].value);console.log(l.attributes);KU({key:l.attributes['data-keyup'].value})})
  }
  for (let c of BT) P(c);
  I('c');
  I('s');
  I('d');
  I('e');
  I('w');
  (J = d[B]('c')),
    (Sc = d[B]('s')),
    (Dc = d[B]('d')),
    (Ec = d[B]('e')),
    (Wc = d[B]('w')),
    (MM = Math.max),
    (pi = Math.PI),
    (RA = Math.random);
  function star(w, cx, cy, sK, oR, iR, FC, SC) {
    let rT = (pi / 2) * 3,
      x = cx,
      y = cy,
      sP = pi / sK;
    w.fillStyle = FC;
    w.strokeStyle = SC;
    w.beginPath();
    w.moveTo(cx, cy - oR);
    for (i = 0; i < sK; i++) {
      x = cx + Math.cos(rT) * oR;
      y = cy + Math.sin(rT) * oR;
      w.lineTo(x, y);
      rT += sP;
      x = cx + Math.cos(rT) * iR;
      y = cy + Math.sin(rT) * iR;
      w.lineTo(x, y);
      rT += sP;
    }
    w.lineTo(cx, cy - oR);
    w.closePath();
    w.stroke();
    w.fill();
  }
  let uS = async (L = null) => {
    let F = ret.files;
    if (S.S) e(S, 'S');
    if (S.N) e(S, 'N');
    if (S.W) e(S, 'W');
    if (S.E) e(S, 'E');
    for (let c of BT) {
      let u = d[cE]('input'),
        y = d[cE]('input'),
        spa = d[cE]('span'),
        checked;
      try {
        checked = d[B]('hI' + c)[gA](q) == '1';
      } catch (e) {}
      d[B](c)[iH] = '';
      spa[iH] = 'None';
      u[sA]('id', 'hI' + c);
      y[sA]('name', c);
      u[sA]('name', c);
      y[sA]('class', 'y');
      u[sA]('class', 'o');
      y[sA]('type', 'radio');
      u[sA]('type', 'radio');
      y[AEL]('change', sB(c));
      spa[AEL]('click', () => {
        y.click();
      });
      try {
        d[B]('sP' + c)[AEL]('click', () => {
          u.click();
        });
      } catch (e) {}
      u[AEL]('change', sB(c));
      y[sA]('id', 'dI' + c);
      if (checked) u[sA](q, 1);
      else y[sA](q, 1);
      d[B](c)[AC](u, spa, y);
      if (!F[c]) continue;
      let t = gP({ animations: F[c].animations, frames: F[c].frames, images: [F[c].src] }),
        W = 'walking-',
        aN = gS(t, W + 'north'),
        aS = gS(t, W + 'south'),
        aW = gS(t, W + 'west'),
        aE = gS(t, W + 'east');
      aS.framerate = aN.framerate = aW.framerate = aE.framerate = 6;
      aN.alpha = nA;
      aS.alpha = dA;
      aW.alpha = wA;
      aE.alpha = eA;
      if (!S.S[c]) S.S[c] = aS;
      if (!S.N[c]) S.N[c] = aN;
      if (!S.W[c]) S.W[c] = aW;
      if (!S.E[c]) S.E[c] = aE;
      O[PC](aS, aN, aW, aE);
    }
    if (L) {
      S[R][L].scale = 2;
      S[R][L].alpha = 2;
      tw(S[R][L]).to({ scale: 1, alpha: 1 }, C);
    }
  };
  let sB = (t) => {
    return function (e) {
      if ((e.target.checked && e.target.id[Su](0, 1) == 'd') || (!e.target.checked && e.target.id[Su](0, 1) == 'h')) {
        for (let c in S) {
          S[c][t].scale = 1;
          tw(S[c][t])
            .to({ scale: 3, alpha: 0 }, C)
            [AEL]('change', (e) => {
              if (e.target.target.scale >= 3) S[c][t].visible = false;
            });
        }
      } else {
        for (let c in S) {
          let X = S[c][t];
          X.scale = 2;
          X.visible = true;
          let origY = X.y;
          let origX = X.x;
          X.y -= 64 * 2;
          X.x -= 32;
          tw(S[c][t]).to({ scale: 1, y: origY, x: origX, alpha: R == c ? 1 : 0 }, C);
        }
      }
    };
  };
  let Fo = (s, a) => {
    for (let c in s[a]) tw(s[a][c]).to({ alpha: 0 }, 100);
  };
  d[AEL]('wheel', (e) => {
    let Tg,
      S = E.canvas;
    if (zD>0) Tg = V + e.deltaY / 4;
    else if (zD<0) Tg = V - e.deltaY / 4;
    else Tg=V;
    console.log({zD,Tg,delta:e.deltaY,zU,zG})
    if (parseInt(zD)===0 && ((e.deltaY > 0 && zU<0) || (e.deltaY < 0 && zU>0))) {
        console.log('restarting');
        zD=-zU;
    }
    console.log({zD,Tg,delta:e.deltaY,zU,zG})
    if ((Tg < 0 && zD<0) || (Tg > zG && zD<0 && e.deltaY>0) || (Tg<0 && zD>0 && e.deltaY<0)) {
        console.log('triggered stop')
        zU=-zD;
        if(Tg<0) Tg=0;
        if (Tg>0) Tg=zG
        zD = 0;
        //Tg = 0;
        return;
    }
    
    if ((Tg > zG && zD<0 && e.deltaY<0) || (Tg<0 && zD<0 && e.deltaY<0) || (Tg>zG && zD>0 && e.deltaY>0)) {
      console.log('triggered loop');
    
      zD = -zD;
      return;
    }
    
    let Z = 1 + ((Tg % zG) / zG)*4;
    E.V = V;
    tw(G).to({ y: h / 2 + Z * 10, scaleY: (S[H] / 2 / J[H]) * (1 / Z) }, 100);
    tw(oC).to({ y: -(16 * (Z - 1) + Math.pow((dS - 1) * 3, 3) - Math.pow(Z - 1, 3)) }, 100);
    tw(E)
      .to({ V: Tg, x: -(((S[Y] + 64) * (Z - 1)) / 2), y: -(((S[H] + 64) * (Z - 1)) / 2), scale: Z }, 100)
      [AEL]('change', (t) => {
        V = t.target.target.V;
      });
  });
  let tH = () => {
    F.alpha = 0.7;
    tw(F).to({ alpha: 0 }, RA() * C + 300);
    setTimeout(tH, RA() * C * 40);
  };
  setTimeout(tH, RA() * C * 30);
  const KU = d.onkeyup = (e) => {
    let tE = (d) => {
      let tER = tw(O)
        .to({ scale: 1 + Math.pow(dS, 2), x: (IP(tcan[gA](Y)) - 64 * Math.pow(dS, 2)) / 2 }, 700)
        .call(() => {
          for (let c in S[d]) S[d][c].paused = true;
        });
      tER[AEL]('change', (e) => {
        SS = e.target.target.scaleX;
        zX = e.target.target.x;
      });
    };
    let sF = (d) => {
      for (let c in S[d]) tw(S[d][c]).to({ alpha: 1, framerate: Math.abs(tS) * 3 }, 100);
    };
    let sV = (d) => {
      for (let c in S[d]) {
        tw(S[d][c]).to({ alpha: 1 }, 100);
        S[d][c].paused = false;
      }
    };
    let sS = (s, t) => tw(D).to({ step: s }, t);
    let tdir = R,
      tS;
    switch (e.key.toUpperCase()) {
      case 'A':
      case 'ARROWLEFT':
        R = 'W';
        tS = D.step - 2;
        if (tS >= 0) tS = -2;
        sS(tS, 250);
        wA = 1;
        sF(R);
        break;
      case 'S':
      case 'ARROWDOWN':
        R = 'S';
        dS += 0.25;
        sS(0, C);
        tE(R);
        dA = 1;
        sV(R);
        break;
      case 'D':
      case 'ARROWRIGHT':
        R = 'E';
        tS = D.step + 2;
        if (tS <= 0) tS = 2;
        sS(tS, 250);
        eA = 1;
        sF(R);
        break;
      case 'W':
      case 'ARROWUP':
        R = 'N';
        dS -= 0.25;
        if (dS < 0) dS = 0;
        sS(0, C);
        tE('N');
        nA = 1;
        sV(R);
        break;
      default:
        return;
    }
    if (tdir == R) return;
    switch (tdir) {
      case 'E':
        eA = 0;
        Fo(S, 'E');
        break;
      case 'W':
        wA = 0;
        Fo(S, 'W');
        break;
      case 'N':
        nA = 0;
        Fo(S, 'N');
        break;
      case 'S':
        dA = 0;
        Fo(S, 'S');
        break;
      default:
        return;
    }
  };
  tcan.onclick = () => {
    d[B]('fT').focus();
    d[B]('fT').blur();
  };
  let E = new JS.Stage(tcan);
  let dN = (unit) => {
    return decodeURIComponent(unit[Su](56).replace(/[0-9a-f]{2}/g, '%$&'));
  };
  (() => {
    let p = '420acf8d7151fb73a556975cad1a60bf13e91d417be084fe87ef100df09f';
    let HL = (t) => {
      return function (i) {
        ret.files[t] = i;
        uS(t);
        let spb = d[cE]('span');
        try {
          spb.id = 'sP' + t;
          if (i.unit) spb[iH] = dN(i.unit);
          else {
            console.log(i);
            spb[iH] = i.src[Su](5).split('/', 2)[0];
          }
          spb[sA]('title', 'Policy:' + i.unit[Su](0, 56) + '\nToken:' + i.unit[Su](56));
        } catch (e) {}
        d[B]('hI' + t)[sA](q, 1);
        d[B]('dI' + t)?.removeAttribute(q);
        d[B](t).after(spb);
      };
    };
    let w = 'walking';
    go(w, p + 'a78df09fa79f').then(HL('body'));
    go(w, p + '9287e2808de29980efb88fe29982efb88f62616e67735f62756e').then(HL('bangs'));
    go(w, p + 'a4af616c69656e').then(HL('head'));
    go(w, p + 'a6b5e29982efb88f70616e74732070696e6b').then(HL('pants'));
    go(w, p + 'a6b6e29982efb88f6768696c6c696573206f72616e').then(HL('shoes'));
    go(w, p + 'a7986a61636b6574207472696d3134').then(HL('trim'));
    go(w, p + 'a798e29982efb88f636c6f74686573206c6f6e3136').then(HL('shirt'));
    go(w, p + 'a798e29982efb88f6a61636b65742066726f6334').then(HL('jacket'));
    go(w, p + 'a7a4e29982efb88f626c7565').then(HL('gloves'));
  })();
  uS();
  d[B]('l').focus();
  let wS, hS;
  J[sA](Y, 256);
  J[sA](H, 256);
  Sc[sA](Y, (wS = tcan[gA](Y)));
  Sc[sA](H, (hS = tcan[gA](H) / 2));
  Dc[sA](Y, wS);
  Dc[sA](H, hS);
  Wc[sA](Y, wS);
  Wc[sA](H, hS);
  Ec[sA](Y, wS);
  Ec[sA](H, hS);
  let gX = 'getContext',
    K = '2d';
  let ctx = J[gX](K),
    stx = Sc[gX](K),
    dtx = Dc[gX](K),
    etx = Ec[gX](K),
    wtx = Wc[gX](K),
    CW = J[Y],
    CH = J[H],
    iD = ctx.getImageData(0, 0, CW, CH),
    DD = iD.data,
    t = (tI = 0);
  dtx.lineJoin = stx.lineJoin = 'round';
  stx.lineWidth = dtx.lineWidth = 2;
  let blob = (d, x, y, gR, gB, cR, cB) => {
    let Ra = MM(gR, gB),
      g = d.createRadialGradient(x, y, gR, x, y, gB),
      CS = 'addColorStop';
    g[CS](0, cR);
    g[CS](1, cB);
    d.fillStyle = g;
    d.filter = 'hue-rotate(' + (Math.round(RA() * 90) - 45) + 'deg)';
    d.beginPath();
    d.arc(x, y, Ra, 0, 2 * pi);
    d.fill();
  };
  let SB = (d, x, y, a, b, c, e, p, f, g, h, i) => {
    star(d, x, y, p, f, g, h, i);
    blob(d, x, y, a, b, c, e);
    let m = 1;
    if (f > 37) {
      m = 1.7;
      star(wtx, x, y, p, f * m, g, h, i);
      blob(wtx, x, y, a * 0.8, b, c, e);
    }
  };
  let wL = (Ra) => wS - 2 * Ra,
    mH = (Ra) => hS - 2 * Ra;
  for (let j = 0; j < 200; j++) {
    let bR = 44 - (1 - Math.pow(1 - RA(), 9)) * 40,
      lR = bR * (RA() * 0.3),
      Ra = MM(bR * 2, lR);
    SB(
      stx,
      RA() * wL(Ra) + Ra,
      RA() * mH(Ra) + Ra,
      bR * 0.7,
      bR * 0.2 * RA(),
      tx,
      '#ccffffaa',
      4,
      bR,
      lR,
      '#00ffff99',
      '#6655ff55',
    );
  }
  for (let j = 0; j < 200; j++) {
    let bR = RA() * 4 + 1,
      lR = bR * 0.1,
      rB = (ct, bR, lR, c) => {
        let Ra = MM(bR, lR);
        blob(ct, RA() * wL(Ra) + Ra, RA() * mH(Ra) + Ra, bR, lR, tx, c);
      };
    rB(dtx, bR, lR, '#0066aa');
    rB(etx, bR, lR, '#0066aa');
    bR = (RA() * 4 + 1) * 17;
    lR = bR * 0.1;
    rB(etx, bR, lR, '#ff000034');
  }
  w = E.canvas[Y];
  h = E.canvas[H];
  let nS = () => {
      return new JS.Shape();
    },
    nH = (k, a) => {
      SH = nS();
      SH[o][T](k)[U](0, 0, wS * 2, hS);
      SH.alpha = a;
      SH.tileW = wS;
      return SH;
    },
    Q = nH(Dc, 1),
    N = nH(Sc, 0.9),
    M = nH(Ec, 0.9),
    F = nH(Wc, 0),
    M2 = nH(Ec, 0.9),
    CO = 'compositeOperation';
  M2[CO] = F[CO] = N[CO] = Q[CO] = 'lighter';
  let cH = (i) => i.cache(0, 0, wS * 2, hS);
  sky = nS();
  sky[o].beginLinearGradientFill(['#002727', '#000'], [0, 1], 0, 0, 0, h / 2)[U](0, 0, w, h / 2);
  sky.cache(0, 0, w, h);
  G = nS();
  G[o][T](J)[U](0, 0, w + CW * 2, CH);
  G.tileW = CW;
  G.y = h / 2;
  G.x = 0 - CW * 2;
  G.scaleY = h / 2 / CH;
  G.cache(0, 0, w + CW * 2, CH);
  O.x = zX;
  O.y = zY;
  O.scale = SS;
  M2.scale = 1.3;
  M.scale = 1.4;
  M2.y = M.y = -(hS * 0.3);
  M2.x = wS / 4;
  F.filters = [new JS.BlurFilter(2, 7, 1)];
  cH(F);
  cH(Q);
  cH(N);
  cH(M);
  cH(M2);
  oC[PC](O);
  E[PC](sky, M, M2, N, F, Q, G, oC);
  let JT = JS.Ticker;
  JT.timingMode = JT.RAF;
  JT[AEL]('tick', E);
  JT[AEL]('tick', drawPlasma);
  function drawPlasma() {
    for (let x = 0; x < CW; x++) {
      for (let y = 0; y < CH; y++) {
        let M = y / (CW * 4),
          r = SN.noise3D((x * M) / 1, y / 1, tI * 0.03) * 0.5 + 0.5,
          g = SN.noise3D((x * M) / 8, y / 8, tI * 0.015) * 0.5 + 0.5,
          A = y / 64;
        (xPos = Math.round(x - A * t)), (xPos = CW + (xPos % CW)), (xPos = xPos % CW);
        let s = (xPos + y * CW) * 4;
        DD[s + 0] = r * 255;
        DD[s + 1] = g * 100;
        DD[s + 2] = g * 200;
        DD[s + 3] = 255 * (y / (CH / 2));
      }
    }
    G.x = 0 - CW + ((G.x - D.step) % G.tileW);
    let ca = (n, c) => (0 - n.tileW * n.scale + n.x - D.step / c) % (wS * n.scale);
    Q.x = ca(Q, 1);
    N.x = ca(N, 2);
    F.x = ca(F, 2);
    M.x = ca(M, 3);
    M2.x = ca(M2, 3 * 1.2);
    t += D.step;
    tI++;
    ctx.putImageData(iD, 0, 0);
    G[o].beginFill('black')[U](0, 0, w + CW * 2, CH);
    G[o].clear();
    G[o][T](J)[U](0, 0, w + CW * 2, CH);
    G.updateCache();
  }
</script>
